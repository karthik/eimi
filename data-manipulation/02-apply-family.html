<h1>Learning the apply family of functions</h1>

<p>One of the greatest joys of vectorized operations is being able to use the entire family of <code>apply</code> functions that are available in base <code>R</code>.</p>

<p>These include:</p>

<pre><code class="r">apply
by
lapply
tapply
sapply
</code></pre>

<h2>apply</h2>

<p><code>apply</code> applies a function to each row or column of a matrix.</p>

<pre><code class="r">m &lt;- matrix(c(1:10, 11:20), nrow = 10, ncol = 2)
m
</code></pre>

<pre><code>##       [,1] [,2]
##  [1,]    1   11
##  [2,]    2   12
##  [3,]    3   13
##  [4,]    4   14
##  [5,]    5   15
##  [6,]    6   16
##  [7,]    7   17
##  [8,]    8   18
##  [9,]    9   19
## [10,]   10   20
</code></pre>

<pre><code class="r"># 1 is the row index
# 2 is the column index
apply(m, 1, sum)
</code></pre>

<pre><code>##  [1] 12 14 16 18 20 22 24 26 28 30
</code></pre>

<pre><code class="r">apply(m, 2, sum)
</code></pre>

<pre><code>## [1]  55 155
</code></pre>

<pre><code class="r">apply(m, 1, mean)
</code></pre>

<pre><code>##  [1]  6  7  8  9 10 11 12 13 14 15
</code></pre>

<pre><code class="r">apply(m, 2, mean)
</code></pre>

<pre><code>## [1]  5.5 15.5
</code></pre>

<h2>by</h2>

<p><code>by</code> applies a function to subsets of a data frame.</p>

<pre><code class="r">head(iris)
</code></pre>

<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
## 6          5.4         3.9          1.7         0.4  setosa
</code></pre>

<pre><code class="r">by(iris[, 1:2], iris[,&quot;Species&quot;], summary)
</code></pre>

<pre><code>## iris[, &quot;Species&quot;]: setosa
##   Sepal.Length   Sepal.Width  
##  Min.   :4.30   Min.   :2.30  
##  1st Qu.:4.80   1st Qu.:3.20  
##  Median :5.00   Median :3.40  
##  Mean   :5.01   Mean   :3.43  
##  3rd Qu.:5.20   3rd Qu.:3.67  
##  Max.   :5.80   Max.   :4.40  
## -------------------------------------------------------- 
## iris[, &quot;Species&quot;]: versicolor
##   Sepal.Length   Sepal.Width  
##  Min.   :4.90   Min.   :2.00  
##  1st Qu.:5.60   1st Qu.:2.52  
##  Median :5.90   Median :2.80  
##  Mean   :5.94   Mean   :2.77  
##  3rd Qu.:6.30   3rd Qu.:3.00  
##  Max.   :7.00   Max.   :3.40  
## -------------------------------------------------------- 
## iris[, &quot;Species&quot;]: virginica
##   Sepal.Length   Sepal.Width  
##  Min.   :4.90   Min.   :2.20  
##  1st Qu.:6.22   1st Qu.:2.80  
##  Median :6.50   Median :3.00  
##  Mean   :6.59   Mean   :2.97  
##  3rd Qu.:6.90   3rd Qu.:3.17  
##  Max.   :7.90   Max.   :3.80
</code></pre>

<pre><code class="r">by(iris[, 1:2], iris[,&quot;Species&quot;], sum)
</code></pre>

<pre><code>## iris[, &quot;Species&quot;]: setosa
## [1] 421.7
## -------------------------------------------------------- 
## iris[, &quot;Species&quot;]: versicolor
## [1] 435.3
## -------------------------------------------------------- 
## iris[, &quot;Species&quot;]: virginica
## [1] 478.1
</code></pre>

<h2>tapply</h2>

<p><code>tapply</code> applies a function to subsets of a vector.</p>

<pre><code class="r">df &lt;- data.frame(names = sample(c(&quot;A&quot;,&quot;B&quot;,&quot;C&quot;), 10, rep = T), length = rnorm(10))
df
</code></pre>

<pre><code>##    names  length
## 1      A -0.5653
## 2      B  1.1595
## 3      A  0.5775
## 4      A -1.2930
## 5      C  0.6175
## 6      C  0.5686
## 7      A -0.9872
## 8      C -0.4055
## 9      A  1.2724
## 10     A -0.7284
</code></pre>

<pre><code class="r">tapply(df$length, df$names, mean)
</code></pre>

<pre><code>##       A       B       C 
## -0.2873  1.1595  0.2602
</code></pre>

<p>Now with a more familiar dataset.</p>

<pre><code class="r">tapply(iris$Petal.Length, iris$Species, mean)
</code></pre>

<pre><code>##     setosa versicolor  virginica 
##      1.462      4.260      5.552
</code></pre>

<h2>lapply (and llply)</h2>

<p>What it does: Returns a list of same length as the input. 
Each element of the output is a result of applying a function to the corresponding element.</p>

<pre><code class="r">my_list &lt;- list(a = 1:10, b = 2:20)
my_list
</code></pre>

<pre><code>## $a
##  [1]  1  2  3  4  5  6  7  8  9 10
## 
## $b
##  [1]  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20
</code></pre>

<pre><code class="r">lapply(my_list, mean)
</code></pre>

<pre><code>## $a
## [1] 5.5
## 
## $b
## [1] 11
</code></pre>

<h2>sapply</h2>

<p><code>sapply</code> is a more user friendly version of <code>lapply</code> and will return a list of matrix where appropriate.</p>

<p>Let&#39;s work with the same list we just created.</p>

<pre><code class="r">my_list
</code></pre>

<pre><code>## $a
##  [1]  1  2  3  4  5  6  7  8  9 10
## 
## $b
##  [1]  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20
</code></pre>

<pre><code class="r">x &lt;- sapply(my_list, mean)
x
</code></pre>

<pre><code>##    a    b 
##  5.5 11.0
</code></pre>

<pre><code class="r">class(x)
</code></pre>

<pre><code>## [1] &quot;numeric&quot;
</code></pre>

<h2>replicate</h2>

<p>An extremely useful function to generate datasets for simulation purposes. </p>

<pre><code class="r">replicate(10, rnorm(10))
</code></pre>

<pre><code>##           [,1]    [,2]     [,3]     [,4]    [,5]     [,6]     [,7]    [,8]
##  [1,] -1.35600 -0.5566 -1.89575 -0.47372 -0.6648 -1.03668  0.18680 -1.1777
##  [2,] -0.23036 -0.6130 -0.74211 -0.45415  0.6224  1.68753  0.59726  0.3173
##  [3,] -0.22951 -0.6947 -0.89050 -0.02462 -0.8256 -0.74224  0.03873 -0.4309
##  [4,] -0.77747 -1.3873  0.09522 -0.25436  0.6498 -1.36114  0.32264 -1.2976
##  [5,]  0.95275  0.4609 -0.04731  0.25737  0.2382  0.83209  0.17630 -0.3043
##  [6,] -0.52299 -1.7422  1.19071  1.05612  1.3638 -2.32047  1.32519 -0.1842
##  [7,]  0.69336  0.1572  0.41683 -0.39558 -0.2788  0.11372  0.83206 -0.4538
##  [8,] -0.18275  1.3648  0.66659 -0.67691  1.2439  0.31303  0.57408 -0.4376
##  [9,] -0.15049  0.5185 -0.48545 -1.04458  1.1639 -0.06416 -0.82060  0.2097
## [10,] -0.04293  1.0480  0.80723 -0.40372  0.2181 -0.15985  0.08712  1.3455
##           [,9]    [,10]
##  [1,] -0.80891 -0.19194
##  [2,]  1.12973 -2.08817
##  [3,]  1.26172 -0.05718
##  [4,] -0.74977  0.86586
##  [5,]  0.19654  0.17250
##  [6,]  1.03730  0.01743
##  [7,] -0.10459  0.41420
##  [8,]  0.08518 -1.59972
##  [9,] -1.17152  0.34032
## [10,]  1.33709 -1.33908
</code></pre>

<pre><code class="r">replicate(10, rnorm(10), simplify = TRUE)
</code></pre>

<pre><code>##           [,1]    [,2]    [,3]     [,4]     [,5]    [,6]    [,7]    [,8]
##  [1,] -0.07816 -0.1208  0.6378  0.35804  0.04135  0.4378  0.8926  0.7157
##  [2,] -1.74283 -0.1218  0.1549 -0.17811 -0.00161 -1.4986 -0.9807 -0.1083
##  [3,]  0.83700  1.7832 -0.9010  0.41051 -0.52500  0.2382  0.3700  0.2878
##  [4,]  0.13122 -1.5863  2.6128  0.49203 -0.44442 -0.5846 -1.0461 -0.6864
##  [5,] -1.44035 -1.3331  0.1859 -0.16497  0.15692  1.1049 -0.4123 -0.4356
##  [6,] -0.53079  0.9961  1.3032  0.03066 -0.79062 -0.9852 -1.7766 -0.3202
##  [7,]  0.61240 -0.9390  0.3434 -0.54457  1.62176  1.1397  0.3760  0.7540
##  [8,]  0.87081 -1.6932 -0.3149 -0.92360 -0.71426 -0.3237 -0.5844 -0.8834
##  [9,] -0.39976  0.3117 -0.7657 -2.46748 -0.78456  0.7625 -0.6072  0.1128
## [10,] -0.31573  0.6063  1.4330 -1.44079  0.97770 -0.6183 -0.3437 -1.0379
##           [,9]   [,10]
##  [1,] -0.68930 -0.9108
##  [2,]  0.74321  0.6513
##  [3,]  0.35830  0.6811
##  [4,]  0.70588 -0.2586
##  [5,]  0.06108 -2.6333
##  [6,] -0.17632 -1.2687
##  [7,]  0.20151  0.2781
##  [8,] -0.07276 -0.8977
##  [9,]  0.59917  0.1075
## [10,]  2.50048  2.0340
</code></pre>

<p>The final arguments turns the result into a vector or matrix if possible.</p>

<h2>mapply</h2>

<p>Its more or less a multivariate version of <code>sapply</code>. It applies a function to all corresponding elements of each argument. </p>

<p>example:</p>

<pre><code class="r">list_1 &lt;- list(a = c(1:10), b = c(11:20))
list_1
</code></pre>

<pre><code>## $a
##  [1]  1  2  3  4  5  6  7  8  9 10
## 
## $b
##  [1] 11 12 13 14 15 16 17 18 19 20
</code></pre>

<pre><code class="r">list_2 &lt;- list(c = c(21:30), d = c(31:40))
list_2
</code></pre>

<pre><code>## $c
##  [1] 21 22 23 24 25 26 27 28 29 30
## 
## $d
##  [1] 31 32 33 34 35 36 37 38 39 40
</code></pre>

<pre><code class="r">mapply(sum, list_1$a, list_1$b, list_2$c, list_2$d)
</code></pre>

<pre><code>##  [1]  64  68  72  76  80  84  88  92  96 100
</code></pre>
